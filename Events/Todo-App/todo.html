<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title></title>
  <style type="text/css">
    /* body {
      background-image: url('background.png');
      width: fit-content
    } */
    /* login*/
    html {
      height: 100%;
    }

    body {
      height: 100%;
      margin: 0;
      font-family: Arial, Helvetica, sans-serif;
      display: grid;
      justify-items: center;
      align-items: center;
      background-color: #3a3a3a;
    }

    #main-holder {
      width: 50%;
      height: 70%;
      display: grid;
      justify-items: center;
      align-items: center;
      background-color: white;
      border-radius: 7px;
      box-shadow: 0px 0px 5px 2px black;
    }

    #login-error-msg-holder {
      width: 100%;
      height: 100%;
      display: grid;
      justify-items: center;
      align-items: center;
    }

    #login-error-msg {
      width: 23%;
      text-align: center;
      margin: 0;
      padding: 5px;
      font-size: 12px;
      font-weight: bold;
      color: #8a0000;
      border: 1px solid #8a0000;
      background-color: #e58f8f;
      opacity: 0;
    }

    #error-msg-second-line {
      display: block;
    }

    #login-form {
      align-self: flex-start;
      display: grid;
      justify-items: center;
      align-items: center;
    }

    .login-form-field::placeholder {
      color: #3a3a3a;
    }

    .login-form-field {
      border: none;
      border-bottom: 1px solid #3a3a3a;
      margin-bottom: 10px;
      border-radius: 3px;
      outline: none;
      padding: 0px 0px 5px 5px;
    }

    #login-form-submit {
      width: 100%;
      padding: 7px;
      border: none;
      border-radius: 5px;
      color: white;
      font-weight: bold;
      background-color: #3a3a3a;
      cursor: pointer;
      outline: none;
    }

    /* login*/

    .list {
      margin: auto;
      width: 320px;
      height: 600px;
      border: solid 1px rgb(36, 32, 28);
      border-radius: 30px;
      background-color: whitesmoke;
      padding: 10px;
      position: relative;
      overflow-y: scroll;
      display: none;

    }

    #auth {
      width: 400px;
      height: 250px;
      background-color: springgreen;
      position: relative;
    }

    .newTaskArea,
    .saveList {
      border-radius: 30px;
      margin: auto;
      width: 90%;
      position: absolute;
      bottom: 15px;
      font-family: fantasy;
      font-style: italic;
      overflow-x: hidden;
      padding: 3px;
    }

    .saveList {
      background-color: springgreen;
      position: inherit;
      margin: 10px auto;
      width: 315px;
      height: 35px;
      font-size: 20px;
      align-content: center;
      font-family: fantasy;
      font-weight: bold;
    }

    .task {
      border-style: solid 1px black;
      border-radius: 30px;
      left: 3px;
      width: 300px;
      height: 30px;
      background-color: whitesmoke;
      margin: auto;
      margin-bottom: 3px;
      position: relative;
      font-family: fantasy;
      font-size: 16px;
      overflow-x: initial;
      padding: 3px
    }

    .done {
      position: absolute;
      right: 3px;
    }

    #saveTask {
      width: 40px;
      height: 20px;
      font-weight: bold;
      position: absolute;
      right: 3px;
    }

    #tasks {
      top: 5px;
      height: 70%;
      padding: 4px;
      overflow-y: scroll;
      top: 5px;
      border: inset 1px;
      background: white;
    }

    .listName {
      font-family: fantasy;
      padding: 6px;
      font-weight: bold;
      text-align: center;
    }

    #userListName {
      font-style: italic;
      display: none;
      height: 20px;
      font-weight: bold;
      border: solid 1px rgb(36, 32, 28);
    }

    *:focus {
      outline: none;
    }
  </style>
</head>

<body>
  <main id="main-holder">
    <h1 id="login-header">Login</h1>

    <div id="login-error-msg-holder">
      <p id="login-error-msg">Invalid username <span id="error-msg-second-line">and/or password</span></p>
    </div>

    <form id="login-form">
      <input type="text" name="username" id="username-field" class="login-form-field" placeholder="Username">
      <input type="password" name="password" id="password-field" class="login-form-field" placeholder="Password">
      <input type="submit" value="Login" id="login-form-submit">
    </form>

  </main>
  <div id='auth'>
    <form id='authUser'>
      <textarea id='user' class='newTaskArea'>
      </textarea>
      <br>
      <textarea id='password' class='newTaskArea'>
      </textarea>
      <div id='login' class='saveList'> LOGIN
      </div>
    </form>
  </div>
  <div id='listarea' class="list" title="TODO LIST">
    <div class='listName'>
      <label id='defaultListName' class="listName"> - TODO - </label>
      <textarea id='userListName' class="listName"> - TODO - </textarea>
    </div>
    <div id='tasks'>
    </div>
    <textarea id='typingArea' class='newTaskArea'>
    </textarea>
  </div>
  <div id='save' class='saveList'> SAVE
  </div>
</body>
<script>

  document.addEventListener('DOMContentLoaded', loadUserData)

  const users = []

  const loginForm = document.getElementById("login-form");
  const loginButton = document.getElementById("login-form-submit");
  const loginErrorMsg = document.getElementById("login-error-msg");
  loginButton.addEventListener("click", (e) => {
    e.preventDefault();
    const username = loginForm.username.value;
    const password = loginForm.password.value;


    if (username === "user" && password === "web_dev") {
      alert("You have successfully logged in.");
      location.reload();
    } else {
      loginErrorMsg.style.opacity = 1;
    }
  })


  var id = 0
  var singleTask = { text: '', status: true }
  var allTasks = []
  //const list = { name: '', tasks }

  //@TODO: get user from local storage
  var lists = []
  var user = { 'username': 'dan', 'password': 'ppp11122', 'lists': [] }
  //@TODO: get from local storage
  var login = document.getElementById('login')
  var typingArea = document.getElementById('typingArea')
  var defaultListName = document.getElementById('defaultListName')
  var userListName = document.getElementById('userListName')
  var saveList = document.getElementById('save')
  // var addNewTask = document.getElementById('addTask')
  // addNewTask.disabled = true

  login.addEventListener('click', authenticate)
  typingArea.addEventListener('keyup', doneTyping)
  typingArea.addEventListener('keypress', (e) => {
    console.log(e)
    if (e.key == 'Enter') {
      if (e.target.value && e.target.value.trim().length > 0) {
        addTask()
      }
    }
  })

  defaultListName.addEventListener('mousedown', editListName)
  defaultListName.addEventListener('mouseover', editListName)

  userListName.addEventListener('keypress', (e) => {
    if (e.key == 'Enter') {
      defaultListName.innerText = userListName.value
      defaultListName.style.display = 'inline'
      userListName.style.display = 'none'
    }
  })
  // saveTask.addEventListener('click', addTask)

  saveList.addEventListener('mousedown', saveThisList)
  saveList.addEventListener('mouseup', (e) => {
    e.target.style.border = 'none'
    e.target.style.backgroundColor = 'springgreen'
  })



  function authenticate() {
    var autharea = document.getElementById('auth')
    autharea.style.display = 'none'
    var listarea = document.getElementById('listarea')
    listarea.style.display = 'block'
    // document.on('')
  }

  function loadUserData() {
    getFromLocalStorage()
  }

  function doneTyping(e) {
    //@TODO add timer!!!
    // if (e.target.value && e.target.value.trim().length > 0) {
    //   addNewTask.disabled = false
    // }
    // else { addNewTask.disabled = true }
  }

  function addTask() {
    var tasks = document.getElementById('tasks')
    let task = document.createElement('div')
    task.id = id++
    let done = document.createElement('INPUT')
    done.setAttribute('type', 'checkbox')
    done.checked = false
    done.classList.add('done')
    task.classList.add('task')
    task.textContent = typingArea.value
    task.appendChild(done)
    tasks.appendChild(task).append(document.createElement('br'))
    allTasks.push({ 'id': task.id, 'task': typingArea.value, 'status': done.checked })
    typingArea.value = ''
    // addNewTask.disabled = true
  }

  function editListName(e) {
    if (e.type == 'mouseover') {
      //@TODO: ADD PENCIL [edit]
    }
    else {
      userListName.style.display = 'inline'
      defaultListName.style.display = 'none'
    }
  }

  function saveThisList(e) {

    e.target.style.border = 'solid'
    e.target.style.backgroundColor = 'seagreen'
    var doneList = document.getElementsByClassName('done')
    for (let i = 0; i < doneList.length; i++) {
      const element = doneList[i].checked;
      console.log(element)
      allTasks[i].done = element
    }
    console.log(allTasks)
    var userListName = document.getElementById('userListName')
    saveListToLocalStorage(allTasks, userListName)

    //@TODO: save to file json  
    //@TODO: solve this
    // var tasks = document.getElementById('tasks')
    // tasks.forEach(task => {
    //   console.log(task)
    // });
  }
  // addTask.addEventListener('mouseDown', typeTask)
  // function typeTask() {
  //   //typing
  // }

  function saveListToLocalStorage(list, name) {
    var users = JSON.parse(localStorage.getItem('users'))

    lists.push({ 'name': name, 'list': list })
    user['lists'].push(lists)

    console.log(users)
    users.push(user)


    var ind = users.findIndex(i => i.username == 'dan')
    users[ind].lists.push(list)

    console.log('users')
    console.log(ind)

    localStorage.setItem('users', JSON.stringify(users))

    // localStorage.setItem('user', JSON.stringify(user))
    var data = localStorage.getItem('users')
    console.log(JSON.parse(data))
  }

  function getFromLocalStorage() {
    var users = localStorage.getItem('users')
    console.log(JSON.parse(users))
  }

</script>

</html>